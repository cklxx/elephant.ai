# 文字转语音网关验收方案

## 1. 环境准备
- 配置至少 2 家 TTS 供应商的测试 Key。  
- 搭建本地 HTTP 代理，用于捕获请求日志。  
- 准备多语言/多情绪文本样例（不少于 10 条）。

## 2. 功能用例
| 编号 | 场景 | 操作 | 预期结果 |
| --- | --- | --- | --- |
| TTS-001 | 基本合成 | 请求中文女声 | 返回 MP3，日志记录 provider/id |
| TTS-002 | 缓存命中 | 重复请求同一文本 | 第二次耗时下降 ≥ 80%，标记 cache_hit=true |
| TTS-003 | Fallback | 主 provider 故障（模拟 500） | 自动切换至备选，返回成功 |
| TTS-004 | 敏感词 | 输入违禁词 | 返回错误，未触发外部请求 |
| TTS-005 | 多格式 | 输出 WAV/MP3 | 文件格式与采样率符合配置 |

## 3. 性能与稳定性
- 单次调用 95 分位耗时 ≤ 2s（云 API）。  
- 并发 10 请求时，无错误率 ≤ 1%。  
- 缓存命中率 ≥ 60%（在测试数据集中）。

## 4. 日志与指标验收
- 日志包含 `provider`, `request_id`, `cached`.  
- 指标：`tts_requests_total`, `tts_cache_hit_ratio`, `tts_failures_total`.  
- 错误场景写入结构化 JSON 方便告警。

## 5. 交付物
- `providers.yaml` 示例（脱敏）。  
- 验收脚本：`scripts/verify_tts_gateway.sh`，模拟并发请求。  
- 敏感词词表与处理策略说明。

## 6. 流程
1. 验收前由甲方提供测试文本与要求。  
2. 实施方演示成功、失败、降级三类场景。  
3. 双方核对日志与指标截图。  
4. 形成验收报告并归档音频样例。
