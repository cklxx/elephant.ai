# elephant.ai 项目演进报告

> 本报告基于 3,163 次提交、480+ PR、6 个版本标签的完整 git 历史和项目文档整理而成。

---

## 核心结论

**elephant.ai 用 7.5 个月（2025-06 → 2026-02）完成了从单人 CLI 编码工具到 Lark 原生多通道主动式 AI 助手平台的蜕变。** 项目经历了三次品牌重塑（Deep Coding Agent → ALEX → Spinner → elephant.ai），每次重塑都标志着产品定位的根本性跃迁。最终形态是一个具备持久记忆、自主执行、内置技能的主动式 AI 助手，嵌入到 Lark 群组成为一等参与者。

---

## 一、演进全景：四大阶段

### 阶段一：CLI 编码智能体（2025-06 ~ 2025-09）— 奠基期

**定位：** 面向开发者的多模型 ReAct 编码助手

| 时间 | 里程碑 | 提交量 |
|------|--------|--------|
| 2025-06-26 | `first commit` — 初始化 Deep Coding Agent CLI | 3 |
| 2025-07 | 爆发式开发：ReAct 循环、TUI、会话缓存、多模型(Gemini/Kimi)、SWE-Bench 评测 | 163 |
| 2025-07-28 | **第一次品牌重塑 → ALEX**（Agile Light Easy Xpert） | — |
| 2025-08 | NPM 分发（v0.0.5/v0.0.6）、CI/CD、TUI 优化、架构文档 | 33 |
| 2025-09 | 单元测试体系建立、WebSocket 集成、v0.4.0/v0.4.1 发布 | 51 |

**关键架构决策：**
- Go 语言 + ReAct（Think → Act → Observe）循环作为核心推理引擎
- 多 LLM 提供商抽象（OpenAI、Claude、ARK、DeepSeek、Kimi、Ollama）
- TUI 终端交互界面 + 会话缓存机制
- SWE-Bench 评测框架验证编码能力

**此阶段本质：** 一个有潜力的 CLI 编码工具，还停留在"开发者工具"的定位。

---

### 阶段二：Web 平台化（2025-10 ~ 2025-11）— 产品化转型

**定位：** 从 CLI 工具演进为 Server + Web 的完整平台

| 时间 | 里程碑 | 提交量 |
|------|--------|--------|
| 2025-10 | 沙箱集成、浏览器工具、Web UI 组件系统、子智能体探索 | 277 |
| 2025-11-20 | **第二次品牌重塑 → Spinner** | — |
| 2025-11 | SSE 事件流、子智能体聚合、附件系统、CN 镜像部署、历史上下文回放 | 621 |

**关键架构演进：**
- **Server 层出现：** 从纯 CLI 到 HTTP Server + SSE 流式推送
- **Web 前端：** Next.js + React 仪表盘，会话管理、工具输出可视化
- **沙箱隔离：** Docker 沙箱提供安全的代码执行和浏览器操作
- **子智能体：** 任务委托和并行执行机制
- **部署：** Docker Compose 完整部署方案，支持国内镜像
- **技能系统雏形：** PPT 生成、深度研究等 Markdown 驱动的工作流

**提交量跃升（277 → 621/月）反映了从"个人项目"到"产品级系统"的转变。**

---

### 阶段三：多通道 AI 助手（2025-12 ~ 2026-01）— 身份确立

**定位：** 嵌入日常工作流的主动式 AI 助手

| 时间 | 里程碑 | 提交量 |
|------|--------|--------|
| 2025-12-19 | **第三次品牌重塑 → elephant.ai** | — |
| 2025-12 | 浏览器自动化 DSL、Markdown 记忆存储、日历/任务管理、附件预签名 URL | 364 |
| 2026-01-09 | 项目历史大合并（squash），repo 清理后以 PR#530 开始新篇 | — |
| 2026-01-18 | 客户端模型选择、订阅目录服务 | — |
| 2026-01-20 | ACP Server 和审批系统 | — |
| 2026-01-26 | TUI 全面升级：BubbleTea 全屏、IME 输入、审批流 | — |
| 2026-01-27 | A2UI 组件协议、JSON-render 模板、子智能体卡片 | — |
| 2026-01-29 | **Lark 机器人网关上线** — 项目关键转折点 | — |
| 2026-01-30 | 记忆系统：会话捕获钩子、技能自动匹配、上下文注入 | — |
| 2026-01-31 | OKR 管理工具、Cron 调度器、计划审批流、附件分层卸载 | 855 |

**这是最具决定性的阶段，奠定了 elephant.ai 的三大支柱：**

#### 支柱 1：Lark 原生集成
- WebSocket 长连接网关（非 HTTP 轮询）
- 消息自动存储到记忆、会话历史注入
- 交互式卡片（模型选择、审批、选项）
- 群聊协作、群消息摘要

#### 支柱 2：持久记忆系统
- Markdown + YAML frontmatter 文件存储
- 自动保存所有 Lark 消息
- 主动上下文召回（用户提问前注入相关历史）
- 多层保留策略（短期会话 / 长期记忆）

#### 支柱 3：自主执行能力
- 12+ 内置技能（深度研究、会议纪要、邮件、PPT、视频）
- 日历/任务 CRUD、冲突检测
- OKR 管理、Cron 定时任务
- 审批网关保障安全性

---

### 阶段四：可靠性工程（2026-02 至今）— 硬化期

**定位：** 从"能用"到"可靠"的系统级强化

| 时间 | 里程碑 | 提交量 |
|------|--------|--------|
| 2026-02-01 | YAML 场景测试框架、Lark 场景覆盖 | — |
| 2026-02-03 | Steward AI 基础（状态管理、安全等级、上下文预算） | — |
| 2026-02-07 | Lark 独立子命令、RL 轨迹管道、评测 Web 平台、全链路追踪 | — |
| 2026-02-08 | Go 原生 DevOps 系统、Lark Supervisor 自愈、评测扩展至 334 案例 | — |
| 2026-02-09 | 聊天级模型选择修复、群聊 API Key 作用域修复 | 796 |

**四条强化主线：**

#### 主线 1：Lark Supervisor 自愈体系
- 重启策略 + 自动修复（autofix）
- SHA 漂移检测 + 自动升级
- 验证感知的重启守卫
- 场景 YAML 测试框架（11 类场景）

#### 主线 2：评测驱动质量
- 基础评测套件：9 个集合、254 → 334 个系统化案例
- 覆盖维度：工具发现、提示有效性、主动性、记忆能力、任务完成速度
- RL 轨迹管道 + LLM 裁判评分
- CI 评测门控

#### 主线 3：Steward AI 安全框架
- L1-L4 工具安全等级分类
- 三层上下文预算（70%/85% 阈值）
- NEW_STATE 协议：模型输出 → 状态持久化 → 重注入
- 40+ 单元测试

#### 主线 4：运维与可观测
- Go 原生 DevOps 编排器（alex dev）
- 分阶段构建（build-before-stop）
- 全链路追踪：ReAct 迭代 + LLM 生成 + 工具执行
- 结构化日志 + 日志分析器

---

## 二、架构演进脉络

```
2025-06     2025-10       2025-12          2026-01           2026-02
   │            │             │                │                │
   ▼            ▼             ▼                ▼                ▼

 CLI Agent   Server+Web    Multi-Channel    Lark-Native     Hardened
 ─────────  ──────────    ────────────     ───────────     ─────────
 ReAct Loop  + HTTP API    + Browser DSL    + WS Gateway    + Supervisor
 TUI         + SSE Stream  + Memory Store   + Auto-Save     + Eval Suite
 Multi-LLM   + Sandbox     + Skills         + Scheduler     + Steward AI
 SWE-Bench   + Subagent    + Attachments    + OKR Tools     + DevOps
             + Next.js UI                   + Card Builder   + RL Pipeline
```

**分层架构（最终态）：**

```
Delivery（CLI / Server / Web / Lark / WeChat）
  → Agent Application Layer（任务准备、协调、成本控制）
    → Domain（ReAct 循环、事件、审批、上下文组装）
      → Infrastructure Adapters（LLM / Tools / Memory / Storage / Observability）
```

---

## 三、关键数据

### 提交分布

| 月份 | 提交数 | 日均 | 阶段 |
|------|--------|------|------|
| 2025-06 | 3 | 1.0 | 创始 |
| 2025-07 | 163 | 5.3 | 爆发 |
| 2025-08 | 33 | 1.1 | 沉淀 |
| 2025-09 | 51 | 1.7 | 测试 |
| 2025-10 | 277 | 8.9 | 平台化 |
| 2025-11 | 621 | 20.7 | 产品化 |
| 2025-12 | 364 | 11.7 | 身份确立 |
| 2026-01 | 855 | 27.6 | 功能密集 |
| 2026-02 | 796 | 88.4* | 硬化期 |

*（截至 2/9，9 天数据）

### 品牌演变

| 名称 | 时间 | 定位 |
|------|------|------|
| Deep Coding Agent | 2025-06 | CLI 编码助手 |
| ALEX | 2025-07 | 敏捷编码专家 |
| Spinner | 2025-11 | Web 平台 AI 助手 |
| **elephant.ai** | **2025-12** | **Lark 原生主动式 AI 助手** |

### 版本里程碑

| 版本 | 日期 | 意义 |
|------|------|------|
| v0.0.5 / v0.0.6 | 2025-08-12 | 首次 NPM 发布 |
| v0.4.0 / v0.4.1 | 2025-09-14 | 稳定化版本 |

---

## 四、核心工程经验沉淀

### 架构原则（从失败中提炼）

1. **凭证刷新必须全覆盖** — 每个创建 LLM 客户端的代码路径都必须经过凭证刷新器；异步后台协程 `preAnalyzeTask` 被遗漏导致 401（2026-02-08）
2. **作用域语义必须精确** — `chat+user` vs `chat` 作用域的微妙差异导致群聊模型选择失效（2026-02-09）
3. **并行度必须受控** — 子智能体无限并发触发上游拒绝，引入 `maxWorkers` 上限 + 启动错峰（2026-02-03）
4. **DB 连接池必须有上限** — 多进程开发环境下 Auth DB 连接耗尽，添加 `pool_max_conns` 配置（2026-02-08）

### 设计哲学

- **Context Engineering > Prompt Hacking** — 宁可多做上下文工程，不走提示词捷径
- **评测驱动 > 直觉判断** — 334 个系统化案例覆盖 12 个维度
- **记忆优先 > 一次性回答** — 自动保存、主动召回、分层保留
- **通道原生 > 外挂集成** — Lark 群组中的一等参与者，而非需要切换的独立应用

---

## 五、当前状态与展望

### 已完成（M0 + M1 核心）
- Lark WebSocket 网关 + Supervisor 自愈
- 日历/任务/OKR 闭环
- 持久记忆 + 主动上下文注入
- 12+ 内置技能
- 基础评测 334 案例全通过
- Go 原生 DevOps + 全链路追踪

### 进行中（M1 收尾）
- Steward 模式激活强制 + 安全审批 UX
- 记忆分层重构（D5：FileStore + 每日摘要）
- 评测集继续扩展 + RL 裁判集成

### 未来方向（M2+）
- 编码智能体网关（回归初心，但以平台能力驱动）
- Shadow Agent 框架
- 深度 Lark 生态（文档/表格/知识库）
- 多智能体协作
- macOS Companion 应用
