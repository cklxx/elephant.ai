# Code Agent 实用指导手册
> Last updated: 2025-11-18

> 如何指导 AI 代码助手产出有效代码和调试 Bug

## 核心原则

### 1. 明确上下文，具体指令
**问题**: AI 生成的代码往往过于通用或不符合项目需求
**解决方案**: 
```
❌ "帮我写个登录功能"
✅ "为 React 18 + TypeScript 项目创建登录组件，使用 JWT 认证，集成现有的 authService，包含表单验证和错误处理"
```

### 2. 分解复杂任务
**问题**: 一次性要求太多功能导致代码混乱
**解决方案**: 按逻辑层次分步骤
```
第1步: 设计数据模型和接口
第2步: 实现核心业务逻辑  
第3步: 添加错误处理和验证
第4步: 集成测试和优化
```

### 3. 提供代码示例
**效果**: 提供示例可以让代码生成准确率提升 68%
```markdown
请参考以下模式创建新的 API 路由：

// 现有模式
app.post('/api/users', validateUser, async (req, res) => {
  try {
    const result = await userService.create(req.body);
    res.json({ success: true, data: result });
  } catch (error) {
    res.status(500).json({ success: false, error: error.message });
  }
});
```

## 提示工程模板

### 五维提示框架

```markdown
## 项目上下文
- 技术栈: [React 18, TypeScript, Node.js, PostgreSQL]
- 项目阶段: [开发/调试/重构] 
- 约束条件: [性能要求、安全标准、代码规范]

## 具体任务
- 目标功能: [详细描述要实现的功能]
- 输入输出: [明确的接口和数据格式]
- 质量标准: [性能指标、测试覆盖率]

## 技术要求
- 设计模式: [推荐使用的模式]
- 最佳实践: [需要遵循的规范] 
- 安全考虑: [特殊的安全要求]

## 验证方式
- 测试策略: [单元测试、集成测试]
- 检查清单: [代码审查要点]
- 性能验证: [基准测试方案]

## 迭代要求
- 反馈机制: [如何收集质量反馈]
- 优化方向: [后续改进计划]
```

### 角色定位提示
```markdown
你是一个有 10 年经验的高级前端工程师，专精 React 生态系统。
请分析这段代码的性能问题并提出优化建议：

[代码片段]

请从以下维度分析:
1. 渲染性能问题
2. 内存泄漏风险  
3. 代码可维护性
4. 具体优化方案
```

## Claude Code 特化指导

### 利用终端原生优势
```bash
# 1. 项目全局理解
"分析当前项目结构，识别主要技术栈和架构模式"

# 2. 跨文件关联开发  
"基于现有的 userService.ts，创建配套的 API 路由和前端组件"

# 3. 工具链集成
"检查代码风格是否符合项目的 ESLint 配置，并自动修复"
```

### 会话持续性利用
```markdown
会话开始: "我正在开发一个电商系统的用户管理模块"

30分钟后: "刚才的用户注册功能需要添加邮箱验证"
[Claude 能记住之前的上下文和代码结构]

1小时后: "用户登录时报 401 错误，帮我调试"  
[Claude 能关联之前的认证实现进行调试]
```

### MCP 协议最佳实践
- 明确工具权限需求："需要读取配置文件和执行 npm 命令"
- 结构化消息格式："以 JSON 格式返回分析结果"
- 错误处理机制："如果测试失败，请分析失败原因并提供修复建议"

## 系统性调试方法

### 问题诊断框架
```markdown
## 第一阶段: 问题定位
1. 错误信息收集
   - 完整的错误堆栈
   - 复现步骤
   - 环境信息 (浏览器、Node版本等)

2. 最小复现场景
   - 隔离问题范围
   - 创建最简测试用例

## 第二阶段: 根因分析  
1. 代码流程追踪
   "请分析这个错误的调用链路，从 API 请求到数据库查询"

2. 数据状态检查
   "检查每个环节的数据变化，定位数据异常点"

## 第三阶段: 解决方案
1. 多方案对比
   "提供 3 种解决方案，分析各自的优劣"
   
2. 风险评估
   "评估修复对现有功能的影响"
```

### 调试提示模板
```markdown
我遇到以下问题:
- 错误现象: [详细描述]
- 错误信息: [完整错误日志] 
- 触发条件: [什么情况下出现]
- 环境信息: [版本、配置等]
- 已尝试方案: [之前的调试步骤]

请帮我:
1. 分析可能的根因
2. 提供调试步骤  
3. 给出修复方案
4. 避免类似问题的预防措施
```

## 代码质量保障

### 三层质量检查
```markdown
## 基础层 - 自动检查
- 语法正确性 ✓
- 代码规范 (ESLint/Prettier) ✓
- 类型安全 (TypeScript) ✓

## 应用层 - 功能验证  
- 单元测试覆盖 ✓
- 边界条件处理 ✓ 
- 错误处理完整性 ✓

## 架构层 - 设计评估
- 代码复杂度控制 ✓
- 依赖关系合理性 ✓
- 可维护性评估 ✓
```

### AI 代码审查清单
```markdown
请从以下角度审查这段代码:

**安全性**
- [ ] 是否存在 SQL 注入风险
- [ ] 用户输入是否经过验证和清理
- [ ] 敏感信息是否正确处理

**性能**  
- [ ] 是否存在 N+1 查询问题
- [ ] 算法复杂度是否合理
- [ ] 内存使用是否优化

**可维护性**
- [ ] 代码结构是否清晰
- [ ] 命名是否规范
- [ ] 是否遵循 SOLID 原则

**健壮性**
- [ ] 异常处理是否完整
- [ ] 边界条件是否考虑
- [ ] 日志记录是否充分
```

## 实战技巧

### 迭代优化策略
```markdown
第一轮: 快速实现
- 目标: 验证核心逻辑可行性
- 重点: 主流程正确性
- 简化: 错误处理、性能优化

第二轮: 健壮性增强
- 补充: 完整的错误处理
- 添加: 输入验证和边界检查
- 优化: 明显的性能瓶颈

第三轮: 生产就绪
- 安全: 全面安全检查
- 监控: 日志和指标收集
- 文档: API 文档和使用说明
```

### 上下文管理技巧
```markdown
# 会话开始时建立完整上下文
"我正在开发一个 [项目类型]，使用 [技术栈]，当前需要实现 [具体功能]。
项目的代码规范是 [具体规范]，请在后续对话中遵循这些约定。"

# 任务切换时刷新上下文  
"现在转到新任务：基于之前开发的用户系统，实现权限管理模块"

# 复杂问题时提供充分信息
"这是项目的整体架构图... 这是相关的代码文件... 现在遇到的问题是..."
```

### 常见陷阱避免
```markdown
❌ 避免的做法:
- "帮我写个完整的系统" (范围太大)
- "这个代码有问题，帮我修复" (信息不足) 
- "按照最佳实践实现" (标准不明确)

✅ 推荐的做法:
- "为订单模块创建支付接口，支持支付宝和微信支付"
- "这段认证中间件在处理过期 token 时报错，错误信息是..."
- "按照项目的 TypeScript strict 模式和 ESLint 配置实现"
```

## 效果评估

### 量化指标
- **开发效率**: 相比传统开发提升 35-50%
- **代码质量**: AI 辅助审查发现问题减少 50%
- **调试效率**: 问题定位时间缩短 40%
- **上下文保持**: Claude Code 平均会话时长 47 分钟

### 成功标准
1. **功能正确**: 一次性通过基本测试 > 90%
2. **代码规范**: 符合项目规范 > 95%  
3. **安全性**: 无明显安全漏洞
4. **可维护**: 代码复杂度在合理范围
5. **性能**: 满足基本性能要求

## 最佳实践总结

1. **明确具体**: 提供清晰的技术规范和业务需求
2. **循序渐进**: 将复杂任务分解为可管理的步骤
3. **示例驱动**: 用具体代码示例指导 AI 理解项目风格
4. **持续验证**: 每个阶段都要进行质量检查和测试
5. **上下文保持**: 充分利用 AI 的会话记忆能力
6. **安全第一**: 始终将安全性放在首要位置
7. **性能意识**: 在设计阶段就考虑性能问题
8. **可维护导向**: 编写易于理解和修改的代码
