'use client';

import { createContext, useCallback, useContext, useMemo } from 'react';

export type Language = 'en';

const translations = {
  en: {
    'app.loading': 'Loading console…',
    'timeline.label': 'Execution timeline',
    'timeline.waiting': 'Waiting for execution to begin',
    'timeline.status.inProgress': 'In progress: {title}',
    'timeline.status.attention': 'Needs attention: {title}',
    'timeline.status.recent': 'Recently completed: {title}',
    'timeline.progress': 'Completed {completed}/{total}',
    'console.brand': 'Alex Console',
    'home.hero.label': 'Research workspace',
    'home.hero.title': 'Run focused research',
    'home.hero.subtitle': 'Open the console and steer runs live.',
    'home.hero.ctaPrimary': 'Open conversation view',
    'home.hero.ctaSecondary': 'Browse sessions',
    'home.feature.chat.title': 'Chat-first',
    'home.feature.chat.description': 'View prompts, replies, and actions together.',
    'home.feature.actions.title': 'Live actions',
    'home.feature.actions.description': 'Watch tool runs with inline status and results.',
    'home.summary.sessions.label': 'Sessions',
    'home.summary.sessions.value': 'Unlimited history',
    'home.summary.sessions.description': 'Pin, rename, and reopen runs in seconds.',
    'home.summary.timeline.label': 'Timeline',
    'home.summary.timeline.value': 'Step-by-step focus',
    'home.summary.timeline.description': 'Jump to steps on any screen and stay in sync.',
    'home.summary.languages.label': 'Languages',
    'home.summary.languages.value': 'English',
    'home.summary.languages.description': 'Interface available in English.',
    'console.heading.active': 'Session {id}',
    'console.heading.idle': 'New task',
    'console.hero.label': 'Alex workspace',
    'console.hero.title.active': 'Continuing session {id}',
    'console.hero.title.idle': 'What should we work on today?',
    'console.hero.subtitle': 'Describe the goal in one line.',
    'console.connection.title': 'Status',
    'console.connection.subtitle': 'Live',
    'console.connection.mock': 'Mock stream enabled',
    'console.connection.newConversation': 'Start new conversation',
    'console.settings.title': 'Workspace',
    'console.settings.timelineStatus': 'Timeline',
    'console.settings.sessionStatus': 'Session state',
    'console.settings.reset': 'Reset',
    'console.settings.sessionLabel': 'Current session',
    'console.settings.sessionEmpty': 'None',
    'console.settings.sessionNone': 'No session',
    'console.history.title': 'Session history',
    'console.history.subtitle': 'Latest runs',
    'console.history.empty': 'No sessions',
    'console.history.emptyDescription': 'Run a task to add one',
    'console.history.pinned': 'Pinned',
    'console.history.recents': 'Recent',
    'console.history.rename': 'Rename session',
    'console.history.renamePlaceholder': 'Session name',
    'console.history.renameConfirm': 'Save name',
    'console.history.renameCancel': 'Cancel rename',
    'console.history.pin': 'Pin session',
    'console.history.unpin': 'Unpin session',
    'console.history.clearSelection': 'Clear',
    'console.history.itemPrefix': 'Session {id}',
    'console.quickstart.title': 'Quick prompts',
    'console.quickstart.items.code': 'Debug code',
    'console.quickstart.items.docs': 'Summarize docs',
    'console.quickstart.items.architecture': 'Review architecture',
    'console.thread.sessionPrefix': 'Session {id}',
    'console.thread.newConversation': 'Live feed',
    'console.thread.autosave': 'Autosave on',
    'conversation.header.label': 'Conversation',
    'conversation.header.active': 'Session {id}',
    'conversation.header.idle': 'Start new run',
    'conversation.header.subtitle': 'Agent activity stays in the stream.',
    'conversation.quickstart.subtitle': 'Pick a prompt.',
    'conversation.quickstart.useSuggestion': 'Use: {suggestion}',
    'conversation.status.doing': 'Working…',
    'conversation.status.completed': 'Completed',
    'conversation.status.failed': 'Failed',
    'conversation.status.listening': 'Listening…',
    'conversation.tools.simpleSummary.heading': 'Tool calls this session',
    'conversation.tools.simpleSummary.sandboxNote': 'Every tool call runs inside the sandbox. System and file access are noted below.',
    'conversation.tools.simpleSummary.inputsLabel': 'Inputs',
    'conversation.tools.simpleSummary.outputLabel': 'Output',
    'conversation.tools.simpleSummary.errorLabel': 'Error',
    'conversation.tools.simpleSummary.sandboxLine': 'Sandbox: {policy}',
    'conversation.tools.simpleSummary.policy.standard': 'standard isolation',
    'conversation.tools.simpleSummary.policy.filesystem': 'filesystem guard',
    'conversation.tools.simpleSummary.policy.system': 'system guard',
    'conversation.tool.timeline.started': '{tool} started',
    'conversation.tool.timeline.streaming': 'Streaming',
    'conversation.tool.timeline.liveOutput': 'Live output',
    'conversation.tool.timeline.completed': 'Complete',
    'conversation.tool.timeline.errored': 'Error',
    'conversation.tool.timeline.duration': '{duration}',
    'conversation.tool.timeline.arguments': 'Inputs',
    'conversation.tool.timeline.errorOutput': 'Errors',
    'conversation.tool.timeline.result': '{tool} result',
    'conversation.tool.timeline.metadata': 'Context',
    'conversation.environment.heading': 'Sandbox environment',
    'conversation.environment.assurance': 'All web tools run inside the sandbox runtime.',
    'conversation.environment.sandbox.required': 'Sandbox required',
    'conversation.environment.sandbox.recommended': 'Sandbox ready',
    'conversation.environment.tools.label': 'Tools ({count})',
    'conversation.environment.tools.none': 'No tool runs yet',
    'conversation.environment.generatedAt': 'Generated: {time}',
    'conversation.environment.lastUpdated': 'Updated: {time}',
    'conversation.environment.capabilities': 'Capabilities',
    'conversation.environment.persistence': 'Persistence',
    'conversation.environment.sandbox.inlineNotice': 'Executed inside the session sandbox workspace.',
    'conversation.environment.todos.heading': 'Next sandbox actions',
    'conversation.environment.todos.manualBadge': 'Manual',
    'conversation.environment.todos.check': 'Mark todo complete',
    'conversation.environment.todos.uncheck': 'Mark todo incomplete',
    'conversation.environment.todos.allComplete': 'All sandbox follow-ups complete. Monitoring continues automatically.',
    'conversation.environment.todos.remaining':
      '{count, plural, one {# sandbox follow-up remaining} other {# sandbox follow-ups remaining}}',
    'conversation.environment.actions.noPlan': 'No sandbox plan is available yet.',
    'conversation.environment.actions.shareTitle': 'Sandbox plan for session {session}',
    'conversation.environment.actions.shareSuccess': 'Sandbox plan shared.',
    'conversation.environment.actions.shareCopied': 'Sandbox plan copied to clipboard.',
    'conversation.environment.actions.shareFailure': 'Unable to share sandbox plan.',
    'conversation.environment.actions.exportSuccess': 'Sandbox plan exported.',
    'conversation.environment.actions.exportFailure': 'Export failed. Try again.',
    'conversation.environment.actions.deleteSuccess': 'Sandbox plan reset for this session.',
    'console.timeline.mobileLabel': 'Timeline snapshot',
    'console.timeline.dialogTitle': 'Execution timeline',
    'console.timeline.dialogDescription': 'Select a step to focus.',
    'console.timeline.sidebarTitle': 'Timeline',
    'console.timeline.sidebarDescription': 'Select a step.',
    'console.empty.badge': 'Waiting',
    'console.empty.title': 'Ready to start',
    'console.empty.description': 'Send a task to begin.',
    'console.input.placeholder.active': '建立一个小猫网站并给到网站ip',
    'console.input.placeholder.idle': '建立一个小猫网站并给到网站ip',
    'console.input.hotkeyHint': 'Enter sends · Shift+Enter newline',
    'console.toast.taskFailed': 'Task execution failed',
    'agent.output.heading': 'Agent output',
    'agent.output.tabs.timeline': 'Timeline',
    'agent.output.tabs.events': 'Events',
    'agent.output.tabs.document': 'Document',
    'agent.output.timeline.empty': 'No timeline steps yet',
    'agent.output.document.title': 'Task result',
    'agent.output.document.fallback': 'Task completed successfully',
    'agent.output.document.empty': 'Document will appear when task completes',
    'agent.output.plan.defaultGoal': 'Research and execute task',
    'agent.output.toolOutputs.title': 'Tool outputs',
    'agent.output.toolOutputs.empty': 'No tool outputs yet',
    'agent.output.toolOutputs.emptyHint': 'Results will appear here as tools execute',
    'connection.connected': 'Connected',
    'connection.reconnecting': 'Reconnecting…',
    'connection.disconnected': 'Offline',
    'connection.reconnect': 'Retry',
    'document.empty.title': 'No document selected',
    'document.empty.description': 'Document content will appear here',
    'document.view.default': 'Default',
    'document.view.reading': 'Reading',
    'document.view.compare': 'Compare',
    'timeline.card.title': 'Execution Timeline',
    'timeline.card.subtitle': 'Track each step at a glance.',
    'timeline.card.progressLabel': 'Progress',
    'timeline.card.progressSummary': '{{completed}} of {{total}} complete',
    'timeline.card.totalDuration': 'Elapsed {{duration}}',
    'timeline.card.toolsUsed': 'Tools used:',
    'timeline.card.tokensUsed': 'Tokens used:',
    'timeline.card.error': 'Error:',
    'timeline.card.expand': 'Expand details',
    'timeline.card.collapse': 'Collapse details',
    'timeline.card.badge.pending': 'Pending',
    'timeline.card.badge.active': 'In progress',
    'timeline.card.badge.complete': 'Complete',
    'timeline.card.badge.error': 'Failed',
    'timeline.column.plan': 'Plan',
    'timeline.column.planEmpty': 'No planned steps yet.',
    'timeline.column.inProgress': 'In progress',
    'timeline.column.inProgressEmpty': 'Execution will appear here once steps begin.',
    'timeline.column.history': 'History',
    'timeline.column.historyEmpty': 'Completed steps will collect here.',
    'plan.title': 'Research Plan',
    'plan.caption.default': 'Review and approve to start execution',
    'plan.caption.readonly': 'Approved plan',
    'plan.collapse': 'Collapse plan',
    'plan.expand': 'Expand plan',
    'plan.goal.label': 'Goal:',
    'plan.steps.label': 'Planned steps ({count}):',
    'plan.steps.status.planned': 'Planned',
    'plan.steps.status.active': 'In progress',
    'plan.steps.status.done': 'Completed',
    'plan.steps.status.failed': 'Needs attention',
    'plan.steps.focus': 'Focus step {index}',
    'plan.steps.focusLabel': 'Focus in timeline',
    'plan.steps.focusActive': 'Jump to active step',
    'plan.iterations': 'Iterations:',
    'plan.tools': 'Tools:',
    'plan.tools.more': '+{count} more',
    'plan.estimates.iterations': '{count} iteration(s) est.',
    'plan.estimates.tools': '{count} tool(s) est.',
    'plan.estimates.durationMinutes': '≈ {minutes} min',
    'plan.estimates.durationHours': '≈ {hours} hr',
    'plan.estimates.durationHoursMinutes': '≈ {hours} hr {minutes} min',
    'plan.storage.count': '{count} cloud export(s)',
    'plan.storage.heading': 'Cloud export targets',
    'plan.storage.access.read': 'Read-only',
    'plan.storage.access.write': 'Write-only',
    'plan.storage.access.read_write': 'Read & write',
    'plan.storage.access.unknown': 'Access: {access}',
    'plan.storage.retentionDay': 'Retention: {days} day',
    'plan.storage.retentionDays': 'Retention: {days} days',
    'plan.storage.noRetention': 'No automatic retention',
    'plan.storage.region': 'Region: {region}',
    'plan.actions.saveChanges': 'Save changes',
    'plan.actions.cancel': 'Cancel',
    'plan.actions.approve': 'Approve & start',
    'plan.actions.modify': 'Modify plan',
    'plan.actions.reject': 'Reject plan',
    'plan.reject.reasonLabel': 'Rejection reason',
    'plan.reject.placeholder': 'Why is this plan not ready to execute?',
    'plan.reject.confirm': 'Confirm rejection',
    'plan.reject.cancel': 'Cancel',
    'plan.progress.heading': 'Execution summary',
    'plan.progress.completed': 'Completed {completed}/{total} steps',
    'plan.progress.status.pending': 'Not started',
    'plan.progress.status.inProgress': 'In progress',
    'plan.progress.status.complete': 'Completed',
    'plan.progress.status.error': 'Requires attention',
    'plan.progress.activeStep': 'Currently running: {title}',
    'plan.progress.latestCompleted': 'Last completed: {title}',
    'plan.progress.viewInTimeline': 'View in timeline',
    'plan.progress.totalDuration': 'Total duration',
    'plan.progress.averageDuration': 'Avg step duration',
    'plan.progress.tokens': 'Tokens consumed',
    'plan.progress.uniqueTools': 'Tools used',
    'plan.edit.goal': 'Edit goal',
    'plan.edit.stepLabel': 'Edit step {index}',
    'plan.move.up': 'Move step {index} up',
    'plan.move.down': 'Move step {index} down',
    'plan.move.dragHandle': 'Reorder step {index}',
    'task.submit.title.running': 'Running…',
    'task.submit.title.default': 'Submit (Enter)',
    'task.submit.running': 'Running',
    'task.submit.label': 'Send',
    'task.stop.title': 'Stop current task',
    'task.stop.label': 'Stop',
    'task.stop.pending': 'Stopping…',
    'task.input.ariaLabel': 'Task input',
    'tool.status.failed': 'Failed',
    'tool.status.completed': 'Completed',
    'tool.toggle.expand': 'Expand output',
    'tool.toggle.collapse': 'Collapse output',
    'tool.toggle.length': ' · {count} characters',
    'tool.section.parameters': 'Parameters',
    'tool.section.error': 'Error',
    'tool.section.output': 'Output',
    'viewport.empty.title': 'No tool outputs yet',
    'viewport.empty.description': 'Results will appear here as tools execute',
    'viewport.title': 'Computer view',
    'viewport.position': '{index} of {total}',
    'viewport.aria.previous': 'Previous output',
    'viewport.aria.next': 'Next output',
    'viewport.aria.enterFullscreen': 'Enter fullscreen mode',
    'viewport.aria.fullscreenViewer': 'Fullscreen tool output viewer',
    'viewport.aria.exitFullscreen': 'Exit fullscreen mode',
    'viewport.fullscreen.close': 'Close',
    'viewport.web.url': 'URL:',
    'viewport.web.screenshot': 'Screenshot',
    'viewport.web.html': 'HTML',
    'viewport.web.screenshotAlt': 'Screenshot',
    'viewport.bash.command': 'Command:',
    'viewport.bash.output': 'Output:',
    'viewport.bash.errorOutput': 'Error output:',
    'viewport.bash.exitCode': 'Exit code:',
    'viewport.diff.split': 'Side by side',
    'viewport.diff.unified': 'Unified',
    'viewport.diff.before': 'Before',
    'viewport.diff.after': 'After',
    'viewport.diff.beforeHeading': '--- Before',
    'viewport.diff.afterHeading': '+++ After',
    'events.empty': 'No events yet. Submit a task to get started.',
    'events.emptyTitle': 'Awaiting agent activity',
    'events.emptyHint': 'Send a task to watch updates stream in.',
    'events.scrollToLatest': 'Jump to latest',
    'events.stream.ariaLabel': 'Agent event stream',
    'events.stream.ariaDescription': 'Live updates appear here. Scroll up to pause auto-scrolling.',
    'events.stream.newEventSingular': '1 new update from the agent.',
    'events.stream.newEventPlural': '{count} new updates from the agent.',
    'events.toolCall.label': 'Tool Call',
    'events.toolCall.timelineLabel': '{tool} tool execution timeline',
    'events.toolCall.copyArguments': 'Copy inputs',
    'events.toolCall.copyResult': 'Copy result',
    'events.toolCall.copyError': 'Copy error',
    'events.toolCall.copied': 'Copied',
    'events.toolCall.id': 'ID',
    'events.toolCall.start': 'Start',
    'events.toolCall.end': 'End',
    'events.taskAnalysis.title': 'Analyzing task',
    'events.taskAnalysis.label': 'Analysis',
    'events.taskAnalysis.goal': 'Goal',
    'events.taskComplete.title': 'Task complete',
    'events.taskComplete.label': 'Summary',
    'events.taskComplete.metrics.iterations': '{count} iterations',
    'events.taskComplete.metrics.tokens': '{count} tokens',
    'events.taskComplete.metrics.duration': '{duration}',
    'events.taskComplete.finalAnswer': 'Final answer',
    'events.taskComplete.empty': 'No answer provided.',
    'events.taskComplete.stopReason': 'Stop reason: {reason}',
    'events.error.title': 'Run failed',
    'events.error.label': 'Error',
    'events.error.recoverable': 'Recoverable',
    'events.error.context': 'Phase {phase} · iteration {iteration}',
    'events.error.details': 'Details',
    'events.thinking.title': 'Thinking…',
    'events.thinking.hint': 'Agent is working',
    'events.iteration.progress': 'Iteration {iteration} of {total}',
    'events.iteration.complete': 'Iteration {iteration} complete',
    'events.iteration.tokens': '{count} tokens',
    'events.iteration.tools': '{count} tools',
    'events.researchPlan.title': 'Research plan ({count} iterations)',
    'events.step.started': 'Step {index}: {description}',
    'events.step.completed': 'Step {index} complete',
    'events.browserInfo.title': 'Browser diagnostics',
    'events.browserInfo.captured': 'Captured {timestamp}',
    'events.browserInfo.statusLabel': 'Status',
    'events.browserInfo.statusAvailable': 'Available',
    'events.browserInfo.statusUnavailable': 'Unavailable',
    'events.browserInfo.messageLabel': 'Message',
    'events.browserInfo.userAgentLabel': 'User-Agent',
    'events.browserInfo.cdpLabel': 'CDP URL',
    'events.browserInfo.vncLabel': 'VNC URL',
    'events.browserInfo.viewportLabel': 'Viewport',
    'events.browserInfo.noData': 'No diagnostics available',
    'sessions.archiveLabel': 'Session archive',
    'sessions.title': 'Session management',
    'sessions.description': 'Review, revisit, and reopen ALEX automated workflows.',
    'sessions.newConversation': 'Start new conversation',
    'sessions.card.title': 'Session {id}',
    'sessions.card.lastTask': 'Last task',
    'sessions.card.taskCount': '{count} tasks',
    'sessions.card.updated': 'Updated {time}',
    'sessions.card.fork': 'Fork',
    'sessions.card.delete': 'Delete',
    'sessions.card.open': 'Open session',
    'sessions.list.confirmDelete.title': 'Delete session?',
    'sessions.list.confirmDelete.description':
      'This action cannot be undone. All session data will be permanently deleted.',
    'sessions.list.confirmDelete.confirm': 'Delete',
    'sessions.list.confirmDelete.cancel': 'Cancel',
    'sessions.list.toast.deleteSuccess.title': 'Session deleted',
    'sessions.list.toast.deleteSuccess.description': 'The session has been permanently removed.',
    'sessions.list.toast.deleteError.title': 'Failed to delete session',
    'sessions.list.toast.deleteError.description': 'Reason: {message}',
    'sessions.list.toast.forkSuccess.title': 'Session forked successfully!',
    'sessions.list.toast.forkSuccess.description': 'New session ID: {id}…',
    'sessions.list.toast.forkError.title': 'Failed to fork session',
    'sessions.list.toast.forkError.description': 'Reason: {message}',
    'sessions.list.error': 'Error loading sessions: {message}',
    'sessions.list.empty': 'No sessions found. Create a new task to start a session.',
    'sessions.list.loading': 'Loading sessions…',
    'sessions.details.back': 'Back',
    'sessions.details.title': 'Session details',
    'sessions.details.sessionId': 'Session ID: {id}',
    'sessions.details.status.active': 'Active',
    'sessions.details.status.inactive': 'Inactive',
    'sessions.details.info.title': 'Session information',
    'sessions.details.info.created': 'Created',
    'sessions.details.info.updated': 'Last updated',
    'sessions.details.info.taskCount': 'Total tasks',
    'sessions.details.newTask': 'New task',
    'sessions.details.history': 'Task history',
    'sessions.details.history.started': 'Started {time}',
    'sessions.details.history.status.completed': 'Completed',
    'sessions.details.history.status.running': 'Running',
    'sessions.details.history.status.pending': 'Pending',
    'sessions.details.history.status.failed': 'Failed',
    'sessions.details.history.status.in_progress': 'In progress',
    'sessions.details.history.status.error': 'Error',
    'sessions.details.toast.taskStarted.title': 'Task started',
    'sessions.details.toast.taskStarted.description': 'Execution has begun in this session.',
    'sessions.details.toast.taskError.title': 'Failed to execute task',
    'sessions.details.toast.taskError.description': 'Reason: {message}',
    'sessions.details.toast.taskCancelRequested.title': 'Cancellation requested',
    'sessions.details.toast.taskCancelRequested.description': 'Attempting to stop the running task.',
    'sessions.details.toast.taskCancelError.title': 'Failed to cancel task',
    'sessions.details.toast.taskCancelError.description': 'Reason: {message}',
    'sessions.details.error': 'Error loading session: {message}',
    'sessions.details.notFound': 'Session not found',
    'sessions.details.loading': 'Loading session…',
    'common.error.unknown': 'Unknown error',
    'sidebar.nav.search': 'Search',
    'sidebar.nav.library': 'Library',
    'sidebar.nav.allTasks': 'All Tasks',
    'sidebar.session.pinned': 'Pinned',
    'sidebar.session.recent': 'Recent',
    'sidebar.session.empty': 'No sessions yet',
    'sidebar.session.new': 'New Session',
    'sidebar.session.rename': 'Rename session',
    'sidebar.session.renamePlaceholder': 'Session name',
    'sidebar.session.confirmRename': 'Save name',
    'sidebar.session.cancelRename': 'Cancel',
    'sidebar.session.pin': 'Pin session',
    'sidebar.session.unpin': 'Unpin session',
    'sidebar.session.delete': 'Delete session',
    'sidebar.session.confirmDelete.title': 'Delete session?',
    'sidebar.session.confirmDelete.description':
      'This action cannot be undone. All session data will be permanently deleted.',
    'sidebar.session.confirmDelete.confirm': 'Delete',
    'sidebar.session.confirmDelete.cancel': 'Cancel',
    'sidebar.session.toast.deleteSuccess': 'Session deleted successfully',
    'sidebar.session.toast.deleteError': 'Failed to delete session',
    'sidebar.toggle.open': 'Open session list',
    'sidebar.toggle.close': 'Close session list',
    'header.actions.share': 'Share',
    'header.actions.more': 'More actions',
    'header.actions.export': 'Export',
    'header.actions.delete': 'Delete',
    'inputBar.placeholder': 'Type your message…',
    'inputBar.actions.attach': 'Attach file',
    'inputBar.actions.voice': 'Voice input',
    'inputBar.actions.send': 'Send message',
    'inputBar.actions.sending': 'Sending…',
    'inputBar.hint.shortcut': 'Enter to send, Shift+Enter for new line',
  },

} as const;

export type TranslationKey = keyof typeof translations.en;

export type TranslationParams = Record<string, string | number>;

interface LanguageContextValue {
  language: Language;
  t: (key: TranslationKey, params?: TranslationParams) => string;
}

const LanguageContext = createContext<LanguageContextValue | null>(null);

const languageLocaleMap: Record<Language, string> = {
  en: 'en-US',
};

export function getLanguageLocale(language: Language): string {
  return languageLocaleMap[language] ?? 'en-US';
}

function format(template: string, params?: TranslationParams) {
  if (!params) return template;
  return template.replace(/\{(\w+)\}/g, (_, token: string) => {
    const value = params[token];
    return value !== undefined ? String(value) : `{${token}}`;
  });
}

export function LanguageProvider({ children }: { children: React.ReactNode }) {
  const language: Language = 'en';

  const translate = useCallback((key: TranslationKey, params?: TranslationParams) => {
    const dictionary = translations[language];
    const fallback = translations.en;
    const template = (dictionary[key] ?? fallback[key]) as string;
    return format(template, params);
  }, []);

  const value = useMemo<LanguageContextValue>(
    () => ({
      language,
      t: translate,
    }),
    [translate]
  );

  return <LanguageContext.Provider value={value}>{children}</LanguageContext.Provider>;
}

export function useI18n() {
  const context = useContext(LanguageContext);
  if (!context) {
    throw new Error('useI18n must be used within a LanguageProvider');
  }
  return context;
}

export function useTranslation() {
  const { t } = useI18n();
  return t;
}
