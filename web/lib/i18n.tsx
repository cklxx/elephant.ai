'use client';

import { createContext, useCallback, useContext, useEffect, useMemo, useState } from 'react';
import { isBrowser } from '@/lib/utils';

export type Language = 'en' | 'zh';

const LANGUAGE_STORAGE_KEY = 'alex.language';

const translations = {
  en: {
    'app.loading': 'Loading console…',
    'language.label': 'Language',
    'language.option.en': 'English',
    'language.option.zh': 'Chinese (Simplified)',
    'language.option.en.short': 'EN',
    'language.option.zh.short': '中',
    'timeline.label': 'Execution timeline',
    'timeline.waiting': 'Waiting for execution to begin',
    'timeline.status.inProgress': 'In progress: {title}',
    'timeline.status.attention': 'Needs attention: {title}',
    'timeline.status.recent': 'Recently completed: {title}',
    'timeline.progress': 'Completed {completed}/{total}',
    'console.brand': 'Alex Console',
    'home.hero.label': 'Research workspace',
    'home.hero.title': 'Run focused research',
    'home.hero.subtitle': 'Open the console and steer runs live.',
    'home.hero.ctaPrimary': 'Open conversation view',
    'home.hero.ctaSecondary': 'Browse sessions',
    'home.feature.chat.title': 'Chat-first',
    'home.feature.chat.description': 'View prompts, replies, and actions together.',
    'home.feature.actions.title': 'Live actions',
    'home.feature.actions.description': 'Watch tool runs with inline status and results.',
    'home.summary.sessions.label': 'Sessions',
    'home.summary.sessions.value': 'Unlimited history',
    'home.summary.sessions.description': 'Pin, rename, and reopen runs in seconds.',
    'home.summary.timeline.label': 'Timeline',
    'home.summary.timeline.value': 'Step-by-step focus',
    'home.summary.timeline.description': 'Jump to steps on any screen and stay in sync.',
    'home.summary.languages.label': 'Languages',
    'home.summary.languages.value': 'English · 中文',
    'home.summary.languages.description': 'Switch languages instantly and keep your preference.',
    'console.heading.active': 'Session {id}',
    'console.heading.idle': 'New task',
    'console.hero.label': 'Alex workspace',
    'console.hero.title.active': 'Continuing session {id}',
    'console.hero.title.idle': 'What should we work on today?',
    'console.hero.subtitle': 'Describe the goal in one line.',
    'console.connection.title': 'Status',
    'console.connection.subtitle': 'Live',
    'console.connection.mock': 'Mock stream enabled',
    'console.connection.newConversation': 'Start new conversation',
    'console.settings.title': 'Workspace',
    'console.settings.timelineStatus': 'Timeline',
    'console.settings.sessionStatus': 'Session state',
    'console.settings.reset': 'Reset',
    'console.settings.sessionLabel': 'Current session',
    'console.settings.sessionEmpty': 'None',
    'console.settings.sessionNone': 'No session',
    'console.history.title': 'Session history',
    'console.history.subtitle': 'Latest runs',
    'console.history.empty': 'No sessions',
    'console.history.emptyDescription': 'Run a task to add one',
    'console.history.pinned': 'Pinned',
    'console.history.recents': 'Recent',
    'console.history.rename': 'Rename session',
    'console.history.renamePlaceholder': 'Session name',
    'console.history.renameConfirm': 'Save name',
    'console.history.renameCancel': 'Cancel rename',
    'console.history.pin': 'Pin session',
    'console.history.unpin': 'Unpin session',
    'console.history.clearSelection': 'Clear',
    'console.history.itemPrefix': 'Session {id}',
    'console.quickstart.title': 'Quick prompts',
    'console.quickstart.items.code': 'Debug code',
    'console.quickstart.items.docs': 'Summarize docs',
    'console.quickstart.items.architecture': 'Review architecture',
    'console.thread.sessionPrefix': 'Session {id}',
    'console.thread.newConversation': 'Live feed',
    'console.thread.autosave': 'Autosave on',
    'conversation.header.label': 'Conversation',
    'conversation.header.active': 'Session {id}',
    'conversation.header.idle': 'Start new run',
    'conversation.header.subtitle': 'Agent activity stays in the stream.',
    'conversation.quickstart.subtitle': 'Pick a prompt.',
    'conversation.quickstart.useSuggestion': 'Use: {suggestion}',
    'conversation.status.doing': 'Working…',
    'conversation.status.completed': 'Completed',
    'conversation.status.failed': 'Failed',
    'conversation.status.listening': 'Listening…',
    'conversation.tools.simpleSummary.heading': 'Tool calls this session',
    'conversation.tools.simpleSummary.sandboxNote': 'Every tool call runs inside the sandbox. System and file access are noted below.',
    'conversation.tools.simpleSummary.inputsLabel': 'Inputs',
    'conversation.tools.simpleSummary.outputLabel': 'Output',
    'conversation.tools.simpleSummary.errorLabel': 'Error',
    'conversation.tools.simpleSummary.sandboxLine': 'Sandbox: {policy}',
    'conversation.tools.simpleSummary.policy.standard': 'standard isolation',
    'conversation.tools.simpleSummary.policy.filesystem': 'filesystem guard',
    'conversation.tools.simpleSummary.policy.system': 'system guard',
    'conversation.tool.timeline.started': '{tool} started',
    'conversation.tool.timeline.streaming': 'Streaming',
    'conversation.tool.timeline.liveOutput': 'Live output',
    'conversation.tool.timeline.completed': 'Complete',
    'conversation.tool.timeline.errored': 'Error',
    'conversation.tool.timeline.duration': '{duration}',
    'conversation.tool.timeline.arguments': 'Inputs',
    'conversation.tool.timeline.errorOutput': 'Errors',
    'conversation.tool.timeline.result': '{tool} result',
    'conversation.environment.heading': 'Sandbox environment',
    'conversation.environment.assurance': 'All web tools run inside the sandbox runtime.',
    'conversation.environment.sandbox.required': 'Sandbox required',
    'conversation.environment.sandbox.recommended': 'Sandbox ready',
    'conversation.environment.tools.label': 'Tools ({count})',
    'conversation.environment.tools.none': 'No tool runs yet',
    'conversation.environment.generatedAt': 'Generated: {time}',
    'conversation.environment.lastUpdated': 'Updated: {time}',
    'conversation.environment.capabilities': 'Capabilities',
    'conversation.environment.persistence': 'Persistence',
    'conversation.environment.sandbox.inlineNotice': 'Executed inside the session sandbox workspace.',
    'conversation.environment.todos.heading': 'Next sandbox actions',
    'conversation.environment.todos.manualBadge': 'Manual',
    'conversation.environment.todos.check': 'Mark todo complete',
    'conversation.environment.todos.uncheck': 'Mark todo incomplete',
    'conversation.environment.todos.allComplete': 'All sandbox follow-ups complete. Monitoring continues automatically.',
    'conversation.environment.todos.remaining':
      '{count, plural, one {# sandbox follow-up remaining} other {# sandbox follow-ups remaining}}',
    'console.timeline.mobileLabel': 'Timeline snapshot',
    'console.timeline.dialogTitle': 'Execution timeline',
    'console.timeline.dialogDescription': 'Select a step to focus.',
    'console.timeline.sidebarTitle': 'Timeline',
    'console.timeline.sidebarDescription': 'Select a step.',
    'console.empty.badge': 'Waiting',
    'console.empty.title': 'Ready to start',
    'console.empty.description': 'Send a task to begin.',
    'console.input.placeholder.active': 'Add detail…',
    'console.input.placeholder.idle': 'Describe your task…',
    'console.input.hotkeyHint': 'Enter sends · Shift+Enter newline',
    'console.toast.taskFailed': 'Task execution failed',
    'agent.output.heading': 'Agent output',
    'agent.output.tabs.timeline': 'Timeline',
    'agent.output.tabs.events': 'Events',
    'agent.output.tabs.document': 'Document',
    'agent.output.timeline.empty': 'No timeline steps yet',
    'agent.output.document.title': 'Task result',
    'agent.output.document.fallback': 'Task completed successfully',
    'agent.output.document.empty': 'Document will appear when task completes',
    'agent.output.plan.defaultGoal': 'Research and execute task',
    'agent.output.toolOutputs.title': 'Tool outputs',
    'agent.output.toolOutputs.empty': 'No tool outputs yet',
    'agent.output.toolOutputs.emptyHint': 'Results will appear here as tools execute',
    'connection.connected': 'Connected',
    'connection.reconnecting': 'Reconnecting…',
    'connection.disconnected': 'Offline',
    'connection.reconnect': 'Retry',
    'document.empty.title': 'No document selected',
    'document.empty.description': 'Document content will appear here',
    'document.view.default': 'Default',
    'document.view.reading': 'Reading',
    'document.view.compare': 'Compare',
    'timeline.card.title': 'Execution Timeline',
    'timeline.card.subtitle': 'Track each step at a glance.',
    'timeline.card.progressLabel': 'Progress',
    'timeline.card.progressSummary': '{{completed}} of {{total}} complete',
    'timeline.card.totalDuration': 'Elapsed {{duration}}',
    'timeline.card.toolsUsed': 'Tools used:',
    'timeline.card.tokensUsed': 'Tokens used:',
    'timeline.card.error': 'Error:',
    'timeline.card.expand': 'Expand details',
    'timeline.card.collapse': 'Collapse details',
    'timeline.card.badge.pending': 'Pending',
    'timeline.card.badge.active': 'In progress',
    'timeline.card.badge.complete': 'Complete',
    'timeline.card.badge.error': 'Failed',
    'plan.title': 'Research Plan',
    'plan.caption.default': 'Review and approve to start execution',
    'plan.caption.readonly': 'Approved plan',
    'plan.collapse': 'Collapse plan',
    'plan.expand': 'Expand plan',
    'plan.goal.label': 'Goal:',
    'plan.steps.label': 'Planned steps ({count}):',
    'plan.iterations': 'Iterations:',
    'plan.tools': 'Tools:',
    'plan.tools.more': '+{count} more',
    'plan.estimates.iterations': '{count} iteration(s) est.',
    'plan.estimates.tools': '{count} tool(s) est.',
    'plan.estimates.durationMinutes': '≈ {minutes} min',
    'plan.estimates.durationHours': '≈ {hours} hr',
    'plan.estimates.durationHoursMinutes': '≈ {hours} hr {minutes} min',
    'plan.actions.saveChanges': 'Save changes',
    'plan.actions.cancel': 'Cancel',
    'plan.actions.approve': 'Approve & start',
    'plan.actions.modify': 'Modify plan',
    'plan.actions.reject': 'Reject plan',
    'plan.reject.reasonLabel': 'Rejection reason',
    'plan.reject.placeholder': 'Why is this plan not ready to execute?',
    'plan.reject.confirm': 'Confirm rejection',
    'plan.reject.cancel': 'Cancel',
    'plan.progress.heading': 'Execution summary',
    'plan.progress.completed': 'Completed {completed}/{total} steps',
    'plan.progress.status.pending': 'Not started',
    'plan.progress.status.inProgress': 'In progress',
    'plan.progress.status.complete': 'Completed',
    'plan.progress.status.error': 'Requires attention',
    'plan.progress.activeStep': 'Currently running: {title}',
    'plan.progress.latestCompleted': 'Last completed: {title}',
    'plan.progress.totalDuration': 'Total duration',
    'plan.progress.averageDuration': 'Avg step duration',
    'plan.progress.tokens': 'Tokens consumed',
    'plan.progress.uniqueTools': 'Tools used',
    'plan.edit.goal': 'Edit goal',
    'plan.edit.stepLabel': 'Edit step {index}',
    'plan.move.up': 'Move step {index} up',
    'plan.move.down': 'Move step {index} down',
    'plan.move.dragHandle': 'Reorder step {index}',
    'task.submit.title.running': 'Running…',
    'task.submit.title.default': 'Submit (Enter)',
    'task.submit.running': 'Running',
    'task.submit.label': 'Send',
    'task.input.ariaLabel': 'Task input',
    'tool.status.failed': 'Failed',
    'tool.status.completed': 'Completed',
    'tool.toggle.expand': 'Expand output',
    'tool.toggle.collapse': 'Collapse output',
    'tool.toggle.length': ' · {count} characters',
    'tool.section.parameters': 'Parameters',
    'tool.section.error': 'Error',
    'tool.section.output': 'Output',
    'viewport.empty.title': 'No tool outputs yet',
    'viewport.empty.description': 'Results will appear here as tools execute',
    'viewport.title': 'Computer view',
    'viewport.position': '{index} of {total}',
    'viewport.aria.previous': 'Previous output',
    'viewport.aria.next': 'Next output',
    'viewport.aria.enterFullscreen': 'Enter fullscreen mode',
    'viewport.aria.fullscreenViewer': 'Fullscreen tool output viewer',
    'viewport.aria.exitFullscreen': 'Exit fullscreen mode',
    'viewport.fullscreen.close': 'Close',
    'viewport.web.url': 'URL:',
    'viewport.web.screenshot': 'Screenshot',
    'viewport.web.html': 'HTML',
    'viewport.web.screenshotAlt': 'Screenshot',
    'viewport.bash.command': 'Command:',
    'viewport.bash.output': 'Output:',
    'viewport.bash.errorOutput': 'Error output:',
    'viewport.bash.exitCode': 'Exit code:',
    'viewport.diff.split': 'Side by side',
    'viewport.diff.unified': 'Unified',
    'viewport.diff.before': 'Before',
    'viewport.diff.after': 'After',
    'viewport.diff.beforeHeading': '--- Before',
    'viewport.diff.afterHeading': '+++ After',
    'events.empty': 'No events yet. Submit a task to get started.',
    'events.emptyTitle': 'Awaiting agent activity',
    'events.emptyHint': 'Send a task to watch updates stream in.',
    'events.scrollToLatest': 'Jump to latest',
    'events.stream.ariaLabel': 'Agent event stream',
    'events.stream.ariaDescription': 'Live updates appear here. Scroll up to pause auto-scrolling.',
    'events.stream.newEventSingular': '1 new update from the agent.',
    'events.stream.newEventPlural': '{count} new updates from the agent.',
    'events.toolCall.label': 'Tool Call',
    'events.toolCall.timelineLabel': '{tool} tool execution timeline',
    'events.toolCall.copyArguments': 'Copy inputs',
    'events.toolCall.copyResult': 'Copy result',
    'events.toolCall.copyError': 'Copy error',
    'events.toolCall.copied': 'Copied',
    'events.toolCall.id': 'ID',
    'events.toolCall.start': 'Start',
    'events.toolCall.end': 'End',
    'events.taskAnalysis.title': 'Analyzing task',
    'events.taskAnalysis.label': 'Analysis',
    'events.taskAnalysis.goal': 'Goal',
    'events.taskComplete.title': 'Task complete',
    'events.taskComplete.label': 'Summary',
    'events.taskComplete.metrics.iterations': '{count} iterations',
    'events.taskComplete.metrics.tokens': '{count} tokens',
    'events.taskComplete.metrics.duration': '{duration}',
    'events.taskComplete.finalAnswer': 'Final answer',
    'events.taskComplete.empty': 'No answer provided.',
    'events.taskComplete.stopReason': 'Stop reason: {reason}',
    'events.error.title': 'Run failed',
    'events.error.label': 'Error',
    'events.error.recoverable': 'Recoverable',
    'events.error.context': 'Phase {phase} · iteration {iteration}',
    'events.error.details': 'Details',
    'events.thinking.title': 'Thinking…',
    'events.thinking.hint': 'Agent is working',
    'events.iteration.progress': 'Iteration {iteration} of {total}',
    'events.iteration.complete': 'Iteration {iteration} complete',
    'events.iteration.tokens': '{count} tokens',
    'events.iteration.tools': '{count} tools',
    'events.researchPlan.title': 'Research plan ({count} iterations)',
    'events.step.started': 'Step {index}: {description}',
    'events.step.completed': 'Step {index} complete',
    'events.browserSnapshot.title': 'Browser snapshot',
    'events.browserSnapshot.alt': 'Browser screenshot',
    'events.browserSnapshot.preview': 'View HTML preview',
    'sessions.archiveLabel': 'Session archive',
    'sessions.title': 'Session management',
    'sessions.description': 'Review, revisit, and reopen ALEX automated workflows.',
    'sessions.newConversation': 'Start new conversation',
    'sessions.card.title': 'Session {id}',
    'sessions.card.lastTask': 'Last task',
    'sessions.card.taskCount': '{count} tasks',
    'sessions.card.updated': 'Updated {time}',
    'sessions.card.fork': 'Fork',
    'sessions.card.delete': 'Delete',
    'sessions.card.open': 'Open session',
    'sessions.list.confirmDelete.title': 'Delete session?',
    'sessions.list.confirmDelete.description':
      'This action cannot be undone. All session data will be permanently deleted.',
    'sessions.list.confirmDelete.confirm': 'Delete',
    'sessions.list.confirmDelete.cancel': 'Cancel',
    'sessions.list.toast.deleteSuccess.title': 'Session deleted',
    'sessions.list.toast.deleteSuccess.description': 'The session has been permanently removed.',
    'sessions.list.toast.deleteError.title': 'Failed to delete session',
    'sessions.list.toast.deleteError.description': 'Reason: {message}',
    'sessions.list.toast.forkSuccess.title': 'Session forked successfully!',
    'sessions.list.toast.forkSuccess.description': 'New session ID: {id}…',
    'sessions.list.toast.forkError.title': 'Failed to fork session',
    'sessions.list.toast.forkError.description': 'Reason: {message}',
    'sessions.list.error': 'Error loading sessions: {message}',
    'sessions.list.empty': 'No sessions found. Create a new task to start a session.',
    'sessions.list.loading': 'Loading sessions…',
    'sessions.details.back': 'Back',
    'sessions.details.title': 'Session details',
    'sessions.details.sessionId': 'Session ID: {id}',
    'sessions.details.status.active': 'Active',
    'sessions.details.status.inactive': 'Inactive',
    'sessions.details.info.title': 'Session information',
    'sessions.details.info.created': 'Created',
    'sessions.details.info.updated': 'Last updated',
    'sessions.details.info.taskCount': 'Total tasks',
    'sessions.details.newTask': 'New task',
    'sessions.details.history': 'Task history',
    'sessions.details.history.started': 'Started {time}',
    'sessions.details.history.status.completed': 'Completed',
    'sessions.details.history.status.running': 'Running',
    'sessions.details.history.status.pending': 'Pending',
    'sessions.details.history.status.failed': 'Failed',
    'sessions.details.history.status.in_progress': 'In progress',
    'sessions.details.history.status.error': 'Error',
    'sessions.details.toast.taskStarted.title': 'Task started',
    'sessions.details.toast.taskStarted.description': 'Execution has begun in this session.',
    'sessions.details.toast.taskError.title': 'Failed to execute task',
    'sessions.details.toast.taskError.description': 'Reason: {message}',
    'sessions.details.error': 'Error loading session: {message}',
    'sessions.details.notFound': 'Session not found',
    'sessions.details.loading': 'Loading session…',
    'common.error.unknown': 'Unknown error',
    'sidebar.nav.search': 'Search',
    'sidebar.nav.library': 'Library',
    'sidebar.nav.allTasks': 'All Tasks',
    'sidebar.session.pinned': 'Pinned',
    'sidebar.session.recent': 'Recent',
    'sidebar.session.empty': 'No sessions yet',
    'sidebar.session.new': 'New Session',
    'sidebar.session.rename': 'Rename session',
    'sidebar.session.renamePlaceholder': 'Session name',
    'sidebar.session.confirmRename': 'Save name',
    'sidebar.session.cancelRename': 'Cancel',
    'sidebar.session.pin': 'Pin session',
    'sidebar.session.unpin': 'Unpin session',
    'header.actions.share': 'Share',
    'header.actions.more': 'More actions',
    'header.actions.export': 'Export',
    'header.actions.delete': 'Delete',
    'inputBar.placeholder': 'Type your message…',
    'inputBar.actions.attach': 'Attach file',
    'inputBar.actions.voice': 'Voice input',
    'inputBar.actions.send': 'Send message',
    'inputBar.actions.sending': 'Sending…',
    'inputBar.hint.shortcut': 'Enter to send, Shift+Enter for new line',
  },
  zh: {
    'app.loading': '加载控制台…',
    'language.label': '语言',
    'language.option.en': '英语',
    'language.option.zh': '简体中文',
    'language.option.en.short': 'EN',
    'language.option.zh.short': '中',
    'timeline.label': '执行时间线',
    'timeline.waiting': '等待执行开始',
    'timeline.status.inProgress': '进行中：{title}',
    'timeline.status.attention': '需要关注：{title}',
    'timeline.status.recent': '最近完成：{title}',
    'timeline.progress': '已完成 {completed}/{total}',
    'console.brand': 'Alex 控制台',
    'home.hero.label': '研究工作台',
    'home.hero.title': '专注完成调研',
    'home.hero.subtitle': '打开控制台，实时引导智能体。',
    'home.hero.ctaPrimary': '打开对话视图',
    'home.hero.ctaSecondary': '查看会话',
    'home.feature.chat.title': '对话优先',
    'home.feature.chat.description': '提示、回复、动作集中呈现。',
    'home.feature.actions.title': '实时动作',
    'home.feature.actions.description': '随时查看状态与结果。',
    'home.summary.sessions.label': '会话',
    'home.summary.sessions.value': '不限历史',
    'home.summary.sessions.description': '快速固定、重命名并重新打开。',
    'home.summary.timeline.label': '时间线',
    'home.summary.timeline.value': '逐步聚焦',
    'home.summary.timeline.description': '任意设备快速跳转步骤。',
    'home.summary.languages.label': '语言',
    'home.summary.languages.value': 'English · 中文',
    'home.summary.languages.description': '随时切换语言并记住偏好。',
    'console.heading.active': '会话 {id}',
    'console.heading.idle': '新任务',
    'console.hero.label': '工作台总览',
    'console.hero.title.active': '继续会话 {id}',
    'console.hero.title.idle': '今天想完成什么？',
    'console.hero.subtitle': '一句话说明目标。',
    'console.connection.title': '状态',
    'console.connection.subtitle': '实时',
    'console.connection.mock': '模拟流已启用',
    'console.connection.newConversation': '新建对话',
    'console.settings.title': '工作区',
    'console.settings.timelineStatus': '时间线',
    'console.settings.sessionStatus': '会话状态',
    'console.settings.reset': '重置',
    'console.settings.sessionLabel': '当前会话',
    'console.settings.sessionEmpty': '无',
    'console.settings.sessionNone': '暂无会话',
    'console.history.title': '历史会话',
    'console.history.subtitle': '最新会话',
    'console.history.empty': '暂无会话',
    'console.history.emptyDescription': '执行任务后出现。',
    'console.history.pinned': '置顶',
    'console.history.recents': '最近',
    'console.history.rename': '重命名会话',
    'console.history.renamePlaceholder': '会话名称',
    'console.history.renameConfirm': '保存名称',
    'console.history.renameCancel': '取消重命名',
    'console.history.pin': '置顶会话',
    'console.history.unpin': '取消置顶',
    'console.history.clearSelection': '清除',
    'console.history.itemPrefix': '会话 {id}',
    'console.quickstart.title': '快捷提示',
    'console.quickstart.items.code': '调试代码',
    'console.quickstart.items.docs': '总结文档',
    'console.quickstart.items.architecture': '架构审阅',
    'console.thread.sessionPrefix': '会话 {id}',
    'console.thread.newConversation': '实时流',
    'console.thread.autosave': '自动保存开启',
    'conversation.header.label': '对话',
    'conversation.header.active': '会话 {id}',
    'conversation.header.idle': '开始新任务',
    'conversation.header.subtitle': '智能体活动都在此流中。',
    'conversation.quickstart.subtitle': '点选提示。',
    'conversation.quickstart.useSuggestion': '应用：{suggestion}',
    'conversation.status.doing': '执行中…',
    'conversation.status.completed': '已完成',
    'conversation.status.failed': '失败',
    'conversation.status.listening': '等待中…',
    'conversation.tools.simpleSummary.heading': '会话工具调用',
    'conversation.tools.simpleSummary.sandboxNote': '所有工具调用均在沙盒中执行，系统与文件访问会单独标注。',
    'conversation.tools.simpleSummary.inputsLabel': '输入',
    'conversation.tools.simpleSummary.outputLabel': '输出',
    'conversation.tools.simpleSummary.errorLabel': '错误',
    'conversation.tools.simpleSummary.sandboxLine': '沙盒：{policy}',
    'conversation.tools.simpleSummary.policy.standard': '标准隔离',
    'conversation.tools.simpleSummary.policy.filesystem': '文件隔离加固',
    'conversation.tools.simpleSummary.policy.system': '系统隔离加固',
    'conversation.tool.timeline.started': '{tool} 已开始',
    'conversation.tool.timeline.streaming': '输出中',
    'conversation.tool.timeline.liveOutput': '实时输出',
    'conversation.tool.timeline.completed': '完成',
    'conversation.tool.timeline.errored': '错误',
    'conversation.tool.timeline.duration': '{duration}',
    'conversation.tool.timeline.arguments': '输入',
    'conversation.tool.timeline.errorOutput': '错误',
    'conversation.tool.timeline.result': '{tool} 结果',
    'conversation.environment.heading': '沙盒环境',
    'conversation.environment.assurance': '网页模式下的全部工具都会在沙盒运行。',
    'conversation.environment.sandbox.required': '必须使用沙盒',
    'conversation.environment.sandbox.recommended': '沙盒已就绪',
    'conversation.environment.tools.label': '工具（{count}）',
    'conversation.environment.tools.none': '尚无工具运行',
    'conversation.environment.generatedAt': '生成时间：{time}',
    'conversation.environment.lastUpdated': '更新时间：{time}',
    'conversation.environment.capabilities': '能力',
    'conversation.environment.persistence': '持久化',
    'conversation.environment.sandbox.inlineNotice': '该工具调用已在本次会话沙盒中执行。',
    'conversation.environment.todos.heading': '沙盒待办',
    'conversation.environment.todos.manualBadge': '手动',
    'conversation.environment.todos.check': '标记待办完成',
    'conversation.environment.todos.uncheck': '标记待办未完成',
    'conversation.environment.todos.allComplete': '沙盒待办已全部完成，自动监控仍在进行。',
    'conversation.environment.todos.remaining':
      '{count, plural, one {剩余 # 项沙盒待办} other {剩余 # 项沙盒待办}}',
    'console.timeline.mobileLabel': '时间线概览',
    'console.timeline.dialogTitle': '执行时间线',
    'console.timeline.dialogDescription': '选择步骤即可定位。',
    'console.timeline.sidebarTitle': '时间线',
    'console.timeline.sidebarDescription': '选择步骤。',
    'console.empty.badge': '等待中',
    'console.empty.title': '准备就绪',
    'console.empty.description': '发送任务即可开始。',
    'console.input.placeholder.active': '补充细节…',
    'console.input.placeholder.idle': '描述任务…',
    'console.input.hotkeyHint': 'Enter 发送 · Shift+Enter 换行',
    'console.toast.taskFailed': '任务执行失败',
    'agent.output.heading': '智能体输出',
    'agent.output.tabs.timeline': '时间线',
    'agent.output.tabs.events': '事件',
    'agent.output.tabs.document': '文档',
    'agent.output.timeline.empty': '暂时没有时间线步骤',
    'agent.output.document.title': '任务结果',
    'agent.output.document.fallback': '任务已成功完成',
    'agent.output.document.empty': '任务完成后将展示文档',
    'agent.output.plan.defaultGoal': '研究并执行任务',
    'agent.output.toolOutputs.title': '工具输出',
    'agent.output.toolOutputs.empty': '暂无工具输出',
    'agent.output.toolOutputs.emptyHint': '工具执行时会在此展示结果',
    'connection.connected': '已连接',
    'connection.reconnecting': '重新连接…',
    'connection.disconnected': '离线',
    'connection.reconnect': '重试',
    'document.empty.title': '尚未选择文档',
    'document.empty.description': '文档内容会显示在这里',
    'document.view.default': '默认',
    'document.view.reading': '阅读',
    'document.view.compare': '对比',
    'timeline.card.title': '执行时间线',
    'timeline.card.subtitle': '快速查看每一步。',
    'timeline.card.progressLabel': '进度',
    'timeline.card.progressSummary': '共 {{total}} 步，已完成 {{completed}} 步',
    'timeline.card.totalDuration': '累计耗时 {{duration}}',
    'timeline.card.toolsUsed': '使用的工具：',
    'timeline.card.tokensUsed': '消耗 Token：',
    'timeline.card.error': '错误信息：',
    'timeline.card.expand': '展开详情',
    'timeline.card.collapse': '收起详情',
    'timeline.card.badge.pending': '待执行',
    'timeline.card.badge.active': '执行中',
    'timeline.card.badge.complete': '已完成',
    'timeline.card.badge.error': '失败',
    'plan.title': '研究计划',
    'plan.caption.default': '审核并批准后开始执行',
    'plan.caption.readonly': '已批准的计划',
    'plan.collapse': '收起计划',
    'plan.expand': '展开计划',
    'plan.goal.label': '目标：',
    'plan.steps.label': '计划步骤（{count}）：',
    'plan.iterations': '迭代次数：',
    'plan.tools': '工具：',
    'plan.tools.more': '+{count} 项',
    'plan.estimates.iterations': '预计 {count} 次迭代',
    'plan.estimates.tools': '预计 {count} 个工具',
    'plan.estimates.durationMinutes': '≈ {minutes} 分钟',
    'plan.estimates.durationHours': '≈ {hours} 小时',
    'plan.estimates.durationHoursMinutes': '≈ {hours} 小时 {minutes} 分钟',
    'plan.actions.saveChanges': '保存修改',
    'plan.actions.cancel': '取消',
    'plan.actions.approve': '批准并开始',
    'plan.actions.modify': '调整计划',
    'plan.actions.reject': '拒绝计划',
    'plan.reject.reasonLabel': '拒绝原因',
    'plan.reject.placeholder': '为什么该计划无法执行？',
    'plan.reject.confirm': '确认拒绝',
    'plan.reject.cancel': '取消',
    'plan.progress.heading': '执行概览',
    'plan.progress.completed': '已完成 {completed}/{total} 步',
    'plan.progress.status.pending': '尚未开始',
    'plan.progress.status.inProgress': '进行中',
    'plan.progress.status.complete': '已完成',
    'plan.progress.status.error': '需要关注',
    'plan.progress.activeStep': '当前执行：{title}',
    'plan.progress.latestCompleted': '最近完成：{title}',
    'plan.progress.totalDuration': '总耗时',
    'plan.progress.averageDuration': '平均步骤耗时',
    'plan.progress.tokens': '消耗 Token',
    'plan.progress.uniqueTools': '使用的工具',
    'plan.edit.goal': '编辑目标',
    'plan.edit.stepLabel': '编辑步骤 {index}',
    'plan.move.up': '上移步骤 {index}',
    'plan.move.down': '下移步骤 {index}',
    'plan.move.dragHandle': '拖拽调整步骤 {index}',
    'task.submit.title.running': '执行中…',
    'task.submit.title.default': '回车提交',
    'task.submit.running': '执行中',
    'task.submit.label': '发送',
    'task.input.ariaLabel': '任务输入框',
    'tool.status.failed': '失败',
    'tool.status.completed': '完成',
    'tool.toggle.expand': '展开输出',
    'tool.toggle.collapse': '收起输出',
    'tool.toggle.length': ' · {count} 字符',
    'tool.section.parameters': '参数',
    'tool.section.error': '错误',
    'tool.section.output': '输出',
    'viewport.empty.title': '暂无工具输出',
    'viewport.empty.description': '工具执行时会在此展示结果',
    'viewport.title': '计算机视图',
    'viewport.position': '第 {index} 项，共 {total} 项',
    'viewport.aria.previous': '上一条输出',
    'viewport.aria.next': '下一条输出',
    'viewport.aria.enterFullscreen': '进入全屏模式',
    'viewport.aria.fullscreenViewer': '全屏工具输出查看器',
    'viewport.aria.exitFullscreen': '退出全屏模式',
    'viewport.fullscreen.close': '关闭',
    'viewport.web.url': '链接：',
    'viewport.web.screenshot': '截图',
    'viewport.web.html': 'HTML',
    'viewport.web.screenshotAlt': '工具截图',
    'viewport.bash.command': '命令：',
    'viewport.bash.output': '输出：',
    'viewport.bash.errorOutput': '错误输出：',
    'viewport.bash.exitCode': '退出码：',
    'viewport.diff.split': '并排查看',
    'viewport.diff.unified': '合并查看',
    'viewport.diff.before': '修改前',
    'viewport.diff.after': '修改后',
    'viewport.diff.beforeHeading': '--- 修改前',
    'viewport.diff.afterHeading': '+++ 修改后',
    'events.empty': '暂无事件。提交任务以开始。',
    'events.emptyTitle': '等待新的动态',
    'events.emptyHint': '提交任务后即可查看实时更新。',
    'events.scrollToLatest': '回到底部查看最新动态',
    'events.stream.ariaLabel': '智能体事件流',
    'events.stream.ariaDescription': '实时更新会显示在这里。向上滚动即可暂停自动滚动。',
    'events.stream.newEventSingular': '智能体产生了 1 条新动态。',
    'events.stream.newEventPlural': '智能体产生了 {count} 条新动态。',
    'events.toolCall.label': '工具调用',
    'events.toolCall.timelineLabel': '{tool} 工具执行时间线',
    'events.toolCall.copyArguments': '复制输入',
    'events.toolCall.copyResult': '复制结果',
    'events.toolCall.copyError': '复制错误',
    'events.toolCall.copied': '已复制',
    'events.toolCall.id': '标识',
    'events.toolCall.start': '开始',
    'events.toolCall.end': '结束',
    'events.taskAnalysis.title': '解析任务',
    'events.taskAnalysis.label': '分析',
    'events.taskAnalysis.goal': '目标',
    'events.taskComplete.title': '任务完成',
    'events.taskComplete.label': '总结',
    'events.taskComplete.metrics.iterations': '{count} 次迭代',
    'events.taskComplete.metrics.tokens': '{count} 个 Token',
    'events.taskComplete.metrics.duration': '{duration}',
    'events.taskComplete.finalAnswer': '最终答案',
    'events.taskComplete.empty': '暂无答案输出。',
    'events.taskComplete.stopReason': '停止原因：{reason}',
    'events.error.title': '执行失败',
    'events.error.label': '错误',
    'events.error.recoverable': '可恢复',
    'events.error.context': '阶段 {phase} · 第 {iteration} 次迭代',
    'events.error.details': '错误详情',
    'events.thinking.title': '正在思考…',
    'events.thinking.hint': '智能体处理中',
    'events.iteration.progress': '第 {iteration} 次迭代，共 {total} 次',
    'events.iteration.complete': '第 {iteration} 次迭代完成',
    'events.iteration.tokens': '{count} 个 Token',
    'events.iteration.tools': '{count} 个工具',
    'events.researchPlan.title': '研究计划（{count} 次迭代）',
    'events.step.started': '步骤 {index}：{description}',
    'events.step.completed': '步骤 {index} 已完成',
    'events.browserSnapshot.title': '浏览器快照',
    'events.browserSnapshot.alt': '浏览器截图',
    'events.browserSnapshot.preview': '查看 HTML 预览',
    'sessions.archiveLabel': '会话归档',
    'sessions.title': '历史会话管理',
    'sessions.description': '查看、回溯并重新打开 ALEX 的自动化工作流。',
    'sessions.newConversation': '新建对话',
    'sessions.card.title': '会话 {id}',
    'sessions.card.lastTask': '最近的任务',
    'sessions.card.taskCount': '任务数：{count}',
    'sessions.card.updated': '更新于 {time}',
    'sessions.card.fork': '分叉',
    'sessions.card.delete': '删除',
    'sessions.card.open': '打开会话',
    'sessions.list.confirmDelete.title': '删除会话？',
    'sessions.list.confirmDelete.description': '该操作无法撤销，所有会话数据将被永久删除。',
    'sessions.list.confirmDelete.confirm': '删除',
    'sessions.list.confirmDelete.cancel': '取消',
    'sessions.list.toast.deleteSuccess.title': '会话已删除',
    'sessions.list.toast.deleteSuccess.description': '该会话已被永久移除。',
    'sessions.list.toast.deleteError.title': '删除会话失败',
    'sessions.list.toast.deleteError.description': '原因：{message}',
    'sessions.list.toast.forkSuccess.title': '分叉会话成功！',
    'sessions.list.toast.forkSuccess.description': '新的会话 ID：{id}…',
    'sessions.list.toast.forkError.title': '分叉会话失败',
    'sessions.list.toast.forkError.description': '原因：{message}',
    'sessions.list.error': '加载会话失败：{message}',
    'sessions.list.empty': '没有找到会话。创建一个新任务来开启会话。',
    'sessions.list.loading': '正在加载会话…',
    'sessions.details.back': '返回',
    'sessions.details.title': '会话详情',
    'sessions.details.sessionId': '会话 ID：{id}',
    'sessions.details.status.active': '进行中',
    'sessions.details.status.inactive': '未激活',
    'sessions.details.info.title': '会话信息',
    'sessions.details.info.created': '创建时间',
    'sessions.details.info.updated': '最近更新时间',
    'sessions.details.info.taskCount': '任务总数',
    'sessions.details.newTask': '新建任务',
    'sessions.details.history': '任务历史',
    'sessions.details.history.started': '开始于 {time}',
    'sessions.details.history.status.completed': '已完成',
    'sessions.details.history.status.running': '执行中',
    'sessions.details.history.status.pending': '待处理',
    'sessions.details.history.status.failed': '失败',
    'sessions.details.history.status.in_progress': '执行中',
    'sessions.details.history.status.error': '错误',
    'sessions.details.toast.taskStarted.title': '任务已开始',
    'sessions.details.toast.taskStarted.description': '该会话的执行已经启动。',
    'sessions.details.toast.taskError.title': '执行任务失败',
    'sessions.details.toast.taskError.description': '原因：{message}',
    'sessions.details.error': '加载会话失败：{message}',
    'sessions.details.notFound': '未找到会话',
    'sessions.details.loading': '正在加载会话…',
    'common.error.unknown': '未知错误',
    'sidebar.nav.search': '搜索',
    'sidebar.nav.library': '库',
    'sidebar.nav.allTasks': '所有任务',
    'sidebar.session.pinned': '置顶',
    'sidebar.session.recent': '最近',
    'sidebar.session.empty': '暂无会话',
    'sidebar.session.new': '新建会话',
    'sidebar.session.rename': '重命名会话',
    'sidebar.session.renamePlaceholder': '会话名称',
    'sidebar.session.confirmRename': '保存名称',
    'sidebar.session.cancelRename': '取消',
    'sidebar.session.pin': '置顶会话',
    'sidebar.session.unpin': '取消置顶',
    'header.actions.share': '分享',
    'header.actions.more': '更多操作',
    'header.actions.export': '导出',
    'header.actions.delete': '删除',
    'inputBar.placeholder': '输入你的消息…',
    'inputBar.actions.attach': '附加文件',
    'inputBar.actions.voice': '语音输入',
    'inputBar.actions.send': '发送消息',
    'inputBar.actions.sending': '发送中…',
    'inputBar.hint.shortcut': 'Enter 发送，Shift+Enter 换行',
  },
} as const;

export type TranslationKey = keyof typeof translations.en;

export type TranslationParams = Record<string, string | number>;

interface LanguageContextValue {
  language: Language;
  setLanguage: (language: Language) => void;
  t: (key: TranslationKey, params?: TranslationParams) => string;
}

const LanguageContext = createContext<LanguageContextValue | null>(null);

const languageLocaleMap: Record<Language, string> = {
  en: 'en-US',
  zh: 'zh-CN',
};

export function getLanguageLocale(language: Language): string {
  return languageLocaleMap[language] ?? 'en-US';
}

function format(template: string, params?: TranslationParams) {
  if (!params) return template;
  return template.replace(/\{(\w+)\}/g, (_, token: string) => {
    const value = params[token];
    return value !== undefined ? String(value) : `{${token}}`;
  });
}

export function LanguageProvider({ children }: { children: React.ReactNode }) {
  const [language, setLanguageState] = useState<Language>('en');

  useEffect(() => {
    if (!isBrowser()) return;

    const stored = window.localStorage.getItem(LANGUAGE_STORAGE_KEY);
    if (stored === 'en' || stored === 'zh') {
      setLanguageState((current) => (current === stored ? current : stored));
      return;
    }

    const browserLanguage = window.navigator.language?.toLowerCase();
    if (browserLanguage && browserLanguage.startsWith('zh')) {
      setLanguageState((current) => (current === 'zh' ? current : 'zh'));
    }
  }, []);

  useEffect(() => {
    if (!isBrowser()) return;

    document.documentElement.lang = language === 'zh' ? 'zh-Hans' : 'en';
    window.localStorage.setItem(LANGUAGE_STORAGE_KEY, language);
  }, [language]);

  const translate = useCallback(
    (key: TranslationKey, params?: TranslationParams) => {
      const dictionary = translations[language];
      const fallback = translations.en;
      const template = (dictionary[key] ?? fallback[key]) as string;
      return format(template, params);
    },
    [language]
  );

  const setLanguage = useCallback((nextLanguage: Language) => {
    setLanguageState(nextLanguage);
  }, []);

  const value = useMemo<LanguageContextValue>(
    () => ({
      language,
      setLanguage,
      t: translate,
    }),
    [language, setLanguage, translate]
  );

  return <LanguageContext.Provider value={value}>{children}</LanguageContext.Provider>;
}

export function useI18n() {
  const context = useContext(LanguageContext);
  if (!context) {
    throw new Error('useI18n must be used within a LanguageProvider');
  }
  return context;
}

export function useTranslation() {
  const { t } = useI18n();
  return t;
}

export const supportedLanguages = [
  {
    code: 'en' as const,
    labelKey: 'language.option.en' as TranslationKey,
    shortKey: 'language.option.en.short' as TranslationKey,
  },
  {
    code: 'zh' as const,
    labelKey: 'language.option.zh' as TranslationKey,
    shortKey: 'language.option.zh.short' as TranslationKey,
  },
];
