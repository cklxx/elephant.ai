name: direct_not_allowed
description: "Direct p2p messages are silently skipped when allow_direct is false"
tags: [filter, p2p, permission]

setup:
  config:
    session_prefix: "test-lark"
    allow_direct: false
    allow_groups: true
  llm_mode: mock

turns:
  - sender_id: "ou_user_no_direct"
    chat_id: "oc_chat_no_direct"
    chat_type: "p2p"
    message_id: "om_msg_no_direct_001"
    content: "这条直接消息应该被忽略"

    mock_response:
      answer: "不应该出现"

    assertions:
      no_call:
        - ReplyMessage
        - SendMessage
      executor:
        called: false
